<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>VIBORAL FUNDICIÓN — Calculadora</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <main class="page">
        <header class="topbar">
            <div class="brand">
                <!-- reemplaza por la imagen que adjuntaste: logo-cobra.png -->
                <img src="logo-cobra.png" alt="Logo Cobra" class="logo-image" width="56" height="56" loading="lazy">
                <div>
                    <div class="title">GESTOR DE PAGOS</div>
                    <div class="subtitle">VIBORAL FUNDICIÓN</div>
                </div>
            </div>

            <div class="actions">
                <button id="refresh-btn" class="btn icon-btn" title="Actualizar precio" aria-label="Actualizar precio">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 1 1 0 6"/></svg>
                </button>

                <!-- Botón: abre la página de Binance P2P (interceptado para mostrar confirmación) -->
                <a id="binance-btn" class="btn binance-btn" href="https://p2p.binance.com/es/trade/all-payments/USDT?fiat=VES" target="_blank" rel="noopener">
                    Ver en Binance P2P
                </a>
            </div>
        </header>

        <section class="panel">
            <div id="usdt-info" class="price-card result">Cargando precio USDT...</div>

            <div class="cards">
                <div id="vecinos" class="vecinos"></div>
                <div id="total" class="result total-card"></div>
            </div>

            <div id="error" class="error" style="display:none;"></div>
        </section>

        <footer class="footer">
            <small>&copy; 2025 SLOWLYM — USDT → VES</small>
        </footer>
    </main>

    <!-- Confirm modal -->
    <div id="confirm-modal" class="modal-backdrop" aria-hidden="true" style="display:none;">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
            <h3 id="modal-title">Referencia de precio</h3>
            <p id="modal-desc">Toma como referencia el primer precio publicado (el anuncio superior) como el precio oficial en Binance P2P y multiplícalo por 115 para posteriormente dividirlo entre 4. La cantidad final será tu total a pagar. ¿Deseas abrir Binance ahora?</p>

            <!-- Imagen de ejemplo añadida -->
            <figure class="modal-sam            // ...existing code...
            const pagoMensual = 115;
            const vecinosBase = 5; // actualizado: ahora 5 vecinos (se agregó Sr. Hector)
            let precioUSDT = null;
            const nombres = [
                "Sra. America",
                "Sra. Carolina",
                "Sr. Jesus",
                "Sr. Jose Gregorio",
                "Sr. Hector"
            ];
            // ...existing code...ple-wrap" aria-hidden="true">
                <img src="modal-sample.png" alt="Ejemplo: primer anuncio en Binance P2P" class="modal-sample" width="300" height="120" loading="lazy">
                <figcaption class="modal-sample-caption">Ejemplo: primer anuncio (precio destacado)</figcaption>
            </figure>

            <div class="modal-actions">
                <button id="modal-cancel" class="btn">Cancelar</button>
                <button id="modal-confirm" class="btn binance-cta">Ir a Binance P2P</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>

    <!-- micro-script: enlaza el botón de refrescar con la función existente obtenerPrecioUSDT()
         y maneja la ventana de confirmación antes de abrir Binance -->
    <script>
    (function(){
        const btn = document.getElementById('refresh-btn');
        const info = document.getElementById('usdt-info');
        if (btn && info) {
            btn.addEventListener('click', () => {
                btn.classList.add('btn-press');
                setTimeout(()=>btn.classList.remove('btn-press'), 220);
                info.classList.remove('price-update');
                void info.offsetWidth;
                info.classList.add('price-update');
                if (typeof obtenerPrecioUSDT === 'function') obtenerPrecioUSDT();
            });
        }

        // Modal logic for Binance link
        const binanceLink = document.getElementById('binance-btn');
        const modal = document.getElementById('confirm-modal');
        const modalCancel = document.getElementById('modal-cancel');
        const modalConfirm = document.getElementById('modal-confirm');

        function showModal() {
            modal.style.display = 'flex';
            modal.setAttribute('aria-hidden','false');
            // focus primer botón
            modalCancel.focus();
            document.body.style.overflow = 'hidden';
        }
        function hideModal() {
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden','true');
            document.body.style.overflow = '';
        }

        if (binanceLink && modal && modalCancel && modalConfirm) {
            binanceLink.addEventListener('click', (e) => {
                e.preventDefault();
                showModal();
            });
            modalCancel.addEventListener('click', hideModal);
            modalConfirm.addEventListener('click', () => {
                const href = binanceLink.href;
                // abrir en nueva pestaña
                window.open(href, '_blank', 'noopener');
                hideModal();
            });
            // cerrar con Esc
            window.addEventListener('keydown', (ev) => {
                if (ev.key === 'Escape' && modal.style.display !== 'none') hideModal();
            });
            // click fuera para cerrar
            modal.addEventListener('click', (ev) => {
                if (ev.target === modal) hideModal();
            });
        }
    })();
    </script>
</body>
</html>